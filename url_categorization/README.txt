# README: Категоризация веб-сайтов

## Описание проекта
Целью проекта было провести категоризацию сайтов, которые посещали пользователи за август, чтобы использовать результаты для исследования того, какие сайты посещают пользователи в целом.

Для категоризации использовались следующие методы:
- Готовая таблица из интернета (оказалась неэффективной);
- Категоризация с помощью ChatGPT;
- Использование сервисов Alphamountain и VirusTotal.

Исходные данные представлены в ZIP-архиве, содержащем информацию о посещениях URL за определённое время. После выполнения всех шагов проекта формируется SQL-запрос, позволяющий категоризировать сайты за произвольные периоды.

**Важно!** Для корректного выполнения проекта файлы следует запускать в указанной ниже последовательности.

---

## Описание файлов

### 1. August_mouth_merge_url.ipynb - Анализ посещаемости веб-сайтов

**Описание:**
- Разархивация данных из архива urls.zip;
- Объединение всех CSV-файлов в один DataFrame;
- Агрегация данных по количеству запросов (count()) для каждого уникального сайта (req_host);
- Сохранение итоговой таблицы в файл `aggregated_visits.csv`.

### 2. Categorization_gpt.ipynb - Анализ данных и категоризация сайтов

**Описание:**
- Обработка файла `aggregated_visits.csv`, выделение 90% наиболее популярных сайтов;
- Использование таблицы `обновленная_таблица_с_ключевыми_словами.xlsx` для предварительной категоризации;
- Применение ChatGPT для автоматической классификации сайтов, снижение доли "Others" до 2.4%;
- Разработка скрипта для генерации регулярных выражений для URL.

### 3. Categorize_url_alpha_API.ipynb - Категоризация через Alphamountain API

**Описание:**
- Использование API Alphamountain для получения категорий и угроз;
- Обработка файла `new_url_task_2.csv`;
- Сохранение результатов в CSV-файл с обновлением каждые 10 обработанных URL.

### 4. Categorize_url_virustotal_API.ipynb - Категоризация через VirusTotal API

**Описание:**
- Использование API VirusTotal для получения категорий;
- Кодирование URL в Base64 и отправка запросов к API;
- Сохранение результатов в CSV-файл с URL и соответствующими категориями;
- Добавление пауз между запросами для предотвращения блокировок.

### 5. Creating_tables_with_categorization_alphamountain_API.ipynb - Преобразование данных Alphamountain

**Описание:**
- Загрузка файлов `categorized_new_url_task_2_final_4.csv` и `am_mapping.csv`;
- Переименование и нормализация столбцов;
- Извлечение кодов категорий и их преобразование в текстовые значения;
- Объединение данных и сохранение результата в `категоризация_alpha_4.csv`.

### 6. Creating_tables_with_categorization_virustotal_API.ipynb - Преобразование данных VirusTotal

**Описание:**
- Чтение всех CSV-файлов из директории `api_categorization_v1`;
- Объединение данных и нормализация категорий;
- Создание столбца `combined_cats` с объединёнными категориями;
- Сохранение результатов в `новая_категоризация_api_virustotal.csv`.

### 7. Comparison_of_sites_with_categories_by_sources.ipynb - Сравнение категорий по источникам

**Описание:**
- Объединение данных из ChatGPT, VirusTotal и Alphamountain;
- Определение наиболее релевантной категории для каждого URL;
- Создание матрицы совпадений категорий между источниками;
- Генерация регулярных выражений для анализа сайтов.

### 8. Query_modify_rozhkov_version.ipynb - Генерация SQL-запроса для категоризации

**Описание:**
- Подсчёт количества сайтов в каждой категории;
- Группировка данных и создание списка URL-адресов для каждой категории;
- Генерация SQL-запроса для категоризации новых данных;
- Вывод статистики и оценки эффективности подхода.

---

## Итог
Проект позволяет автоматизировать процесс категоризации веб-сайтов с использованием различных методов и сервисов. В результате работы вы получите SQL-запрос, который можно применять для дальнейшего анализа посещаемых сайтов.

Запускайте файлы строго в указанном порядке для корректного выполнения всех этапов анализа и категоризации.

